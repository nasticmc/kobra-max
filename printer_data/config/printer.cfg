# This file contains common pin mappings for the BIGTREETECH Manta M5P
# To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" "8 MHz crystal"
# and "USB (on PA11/PA12)" or "CAN bus (on PD0/PD1)".

# See docs/Config_Reference.md for a description of parameters.
[include macro.cfg]
[include mainsail.cfg]
[include scanner.cfg]
[include tilt.cfg]


[safe_z_home]
home_xy_position: 200, 200
# Example home_xy_position: 175,175 - This would be for a 350 * 350mm bed. 
z_hop: 10

[temperature_sensor BTT_Manta]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[temperature_sensor BTT_CB1]
sensor_type: temperature_host
min_temp: 0
max_temp: 100


[stepper_x]
step_pin: PC8
dir_pin: !PC9
enable_pin: !PA15
microsteps: 16
rotation_distance: 40
endstop_pin: tmc2209_stepper_x:virtual_endstop
homing_retract_dist: 0
#endstop_pin: ^PD3
position_endstop: 0
position_max: 410
homing_speed: 50

[tmc2209 stepper_x]
uart_pin: PD9
driver_SGTHRS: 128  # 255 is most sensitive value, 0 is least sensitive
run_current: 0.600
diag_pin: PD3

[stepper_y]
step_pin: PA10
dir_pin: !PA14
enable_pin: !PA13
microsteps: 16
rotation_distance: 40
#endstop_pin: ^PD2
position_endstop: 400
endstop_pin: tmc2209_stepper_y:virtual_endstop
homing_retract_dist: 0
position_max: 400
homing_speed: 50

[tmc2209 stepper_y]
uart_pin: PD8
run_current: 0.800
driver_SGTHRS: 100  # 255 is most sensitive value, 0 is least sensitive
diag_pin: PD2

[stepper_z]
step_pin: PC6
dir_pin: PC7
enable_pin: !PA9
microsteps: 16
rotation_distance: 8
#endstop_pin: ^PC3
#position_endstop: 0.0
endstop_pin: probe:z_virtual_endstop # uses cartographer as virtual endstop
homing_retract_dist: 0 
position_max: 450

[tmc2209 stepper_z]
uart_pin: PB10
run_current: 0.800
diag_pin: PC3

[stepper_z1]
step_pin: PB0
dir_pin: PB1
enable_pin: !PC4
microsteps: 16
rotation_distance: 8
#endstop_pin: ^PC2
endstop_pin: probe:z_virtual_endstop

[tmc2209 stepper_z1]
uart_pin: PA6
run_current: 0.800
diag_pin:

[extruder]
step_pin: PB12
dir_pin: !PB11
enable_pin: !PA8
microsteps: 16
rotation_distance: 33.500
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PC5
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA1
control: pid
pid_Kp: 21.527
pid_Ki: 1.063
pid_Kd: 108.982
min_temp: 0
max_temp: 250

[tmc2209 extruder]
uart_pin: PB2
run_current: 0.600
diag_pin: PC2

#sensor_type:MAX31865
#sensor_pin: PA4
#spi_bus: spi1
#rtd_nominal_r: 100
#rtd_reference_r: 430
#rtd_num_of_wires: 2

#[filament_switch_sensor material_0]
#switch_pin: PC2

#[extruder1]
#step_pin: PB0
#dir_pin: PB1
#enable_pin: !PC4
#heater_pin: PA7
#sensor_pin: PA2
#...

[heater_bed]
heater_pin: PA5
sensor_type: Generic 3950
sensor_pin: PA0
control: watermark
min_temp: 0
max_temp: 130

[fan]
pin: PA4

[heater_fan fan1]
pin: PA3

#[heater_fan SoC_fan]
#pin: CB1:gpio79
#pin: RPI:gpio26

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_hurakan-if00

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100

########################################
# TMC2209 configuration
########################################

#[tmc2209 stepper_x]
#uart_pin: PD9
#run_current: 0.800
#diag_pin: PD3

#[tmc2209 stepper_y]
#uart_pin: PD8
#run_current: 0.800
#diag_pin: PD2

#[tmc2209 stepper_z]
#uart_pin: PB10
#run_current: 0.800
#diag_pin: PC3

#[tmc2209 extruder]
#uart_pin: PB2
#run_current: 0.600
#diag_pin: PC2

#[tmc2209 extruder1]
#uart_pin: PA6
#run_current: 0.600
#diag_pin:

########################################
# TMC2130 configuration
########################################

#[tmc2130 stepper_x]
#cs_pin: PD9
#spi_bus: spi2
#run_current: 0.800
#stealthchop_threshold: 999999
#diag1_pin: PD3

#[tmc2130 stepper_y]
#cs_pin: PD8
#spi_bus: spi2
#run_current: 0.800
#stealthchop_threshold: 999999
#diag1_pin: PD2

#[tmc2130 stepper_z]
#cs_pin: PB10
#spi_bus: spi2
#run_current: 0.650
#stealthchop_threshold: 999999
#diag1_pin: PC3

#[tmc2130 extruder]
#cs_pin: PB2
#spi_bus: spi2
#run_current: 0.800
#stealthchop_threshold: 999999
#diag1_pin: PC2

#[tmc2130 extruder1]
#cs_pin: PA6
#spi_bus: spi2
#run_current: 0.800
#stealthchop_threshold: 999999
#diag1_pin:

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PD5, EXP1_3=PB3, EXP1_5=PB5, EXP1_7=PB7, EXP1_9=<GND>,
    EXP1_2=PD4,  EXP1_4=PD6, EXP1_6=PB4, EXP1_8=PB6, EXP1_10=<5V>,
    # EXP2 header
    EXP2_1=PB14, EXP2_3=PB8, EXP2_5=PC10, EXP2_7=PC12,  EXP2_9=<GND>,
    EXP2_2=PB13, EXP2_4=PB9, EXP2_6=PB15, EXP2_8=<RST>, EXP2_10=<NC>

# See the sample-lcd.cfg file for definitions of common LCD displays.

#[bltouch]
#sensor_pin: PC13
#control_pin: PC15

# Proximity switch
#[probe]
#pin: PC15

#[neopixel my_neopixel1]
#pin: PC11

#[neopixel my_neopixel2]
#pin: PC14

#[adxl345]
#cs_pin: PC0
#spi_bus: spi2

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_z_offset = 1.015
#*#
#*# [scanner model default]
#*# model_coef = 1.6435266922697016,
#*# 	  2.252325313949008,
#*# 	  0.8587216866773193,
#*# 	  -0.7533600234896598,
#*# 	  0.019984983926440512,
#*# 	  2.297896805935329,
#*# 	  -0.11089619324453598,
#*# 	  -2.2318573420742402,
#*# 	  0.240014306312152,
#*# 	  0.8924998700773182
#*# model_domain = 3.365796819243377e-07,3.4114796530592023e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 22.288798
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.664756, 0.898303, 0.870022, 0.963124, 1.013090, 1.062520, 1.062161, 1.038476, 1.023349, 1.008779, 1.031596, 1.010025, 0.990078, 0.972417, 0.943489, 0.985234, 0.994383, 0.955665, 0.919946, 0.884828, 0.908894, 0.897176, 0.866483, 0.817797, 0.762785, 0.741420, 0.701420, 0.558571, 0.442223, 0.337520
#*# 	0.650302, 0.922784, 0.896518, 0.997676, 1.034793, 1.050280, 1.063469, 1.032067, 1.020297, 1.018141, 1.013374, 1.004252, 0.981774, 0.964856, 0.946645, 0.973078, 0.972113, 0.940704, 0.911516, 0.882542, 0.889822, 0.869615, 0.852587, 0.805352, 0.736404, 0.730142, 0.697280, 0.545506, 0.491025, 0.331451
#*# 	0.676354, 0.928224, 0.966448, 1.007288, 1.007225, 1.040743, 1.034507, 1.007340, 0.993686, 0.959971, 0.993706, 0.972906, 0.942507, 0.942222, 0.905133, 0.945692, 0.948918, 0.901801, 0.883241, 0.830808, 0.851751, 0.844671, 0.797993, 0.753518, 0.689484, 0.673859, 0.640697, 0.565651, 0.449249, 0.298726
#*# 	0.603626, 0.886749, 0.906265, 0.922784, 0.950148, 0.959192, 0.964009, 0.922183, 0.900643, 0.900421, 0.902106, 0.899124, 0.886153, 0.866867, 0.842972, 0.876593, 0.866216, 0.831940, 0.804321, 0.768741, 0.769125, 0.742810, 0.720744, 0.660707, 0.589798, 0.584104, 0.549079, 0.453266, 0.380437, 0.223861
#*# 	0.529220, 0.785020, 0.802520, 0.827649, 0.819827, 0.858913, 0.848742, 0.822219, 0.797841, 0.767684, 0.820733, 0.804671, 0.783317, 0.775362, 0.747329, 0.789946, 0.786122, 0.738657, 0.715653, 0.657095, 0.674761, 0.657307, 0.604621, 0.557029, 0.486380, 0.475315, 0.435357, 0.376375, 0.280833, 0.147692
#*# 	0.407056, 0.700616, 0.702090, 0.713017, 0.731874, 0.743097, 0.762863, 0.716702, 0.698922, 0.702465, 0.715505, 0.726517, 0.716469, 0.703003, 0.687981, 0.715142, 0.709237, 0.674344, 0.645168, 0.606187, 0.602967, 0.575788, 0.549273, 0.491712, 0.421529, 0.410967, 0.385418, 0.299581, 0.255621, 0.117786
#*# 	0.321916, 0.594112, 0.598254, 0.612240, 0.610634, 0.655973, 0.653721, 0.635684, 0.619270, 0.598393, 0.652443, 0.649794, 0.637770, 0.639694, 0.614279, 0.663045, 0.664426, 0.624731, 0.592739, 0.539008, 0.555781, 0.534294, 0.486506, 0.435826, 0.373945, 0.357838, 0.334452, 0.286990, 0.204149, 0.084013
#*# 	0.198922, 0.501204, 0.491849, 0.496483, 0.516984, 0.540455, 0.566403, 0.531487, 0.521406, 0.533528, 0.557044, 0.572150, 0.569000, 0.563620, 0.551593, 0.553782, 0.590073, 0.559931, 0.526081, 0.491052, 0.491798, 0.460603, 0.440288, 0.375450, 0.312017, 0.304299, 0.283783, 0.209577, 0.180799, 0.066152
#*# 	0.132709, 0.405656, 0.402581, 0.422042, 0.414750, 0.467428, 0.473240, 0.457474, 0.449443, 0.433984, 0.498798, 0.506313, 0.492256, 0.506704, 0.465826, 0.492148, 0.541975, 0.498378, 0.479129, 0.424588, 0.444318, 0.417814, 0.365589, 0.324059, 0.257054, 0.250215, 0.226120, 0.186045, 0.130559, 0.026536
#*# 	0.037464, 0.340138, 0.332946, 0.334589, 0.360214, 0.383760, 0.410069, 0.381759, 0.375367, 0.398508, 0.429615, 0.442989, 0.445252, 0.442719, 0.436988, 0.479249, 0.481096, 0.452093, 0.423927, 0.392030, 0.390424, 0.360483, 0.337582, 0.271480, 0.210622, 0.204162, 0.185137, 0.124107, 0.104576, 0.006857
#*# 	-0.002455, 0.274562, 0.260650, 0.275276, 0.268367, 0.319899, 0.319196, 0.315353, 0.311452, 0.296650, 0.370538, 0.370295, 0.366988, 0.377227, 0.351807, 0.413529, 0.417251, 0.378618, 0.361431, 0.308653, 0.331572, 0.305727, 0.247140, 0.206365, 0.142758, 0.134919, 0.114182, 0.080298, 0.023739, -0.058619
#*# 	-0.074278, 0.221221, 0.203083, 0.200200, 0.210286, 0.238307, 0.256295, 0.234245, 0.230750, 0.250900, 0.288249, 0.299317, 0.298040, 0.297681, 0.286211, 0.333308, 0.326604, 0.304305, 0.279209, 0.248563, 0.251218, 0.218668, 0.197748, 0.132625, 0.076423, 0.066609, 0.048123, -0.011960, -0.020326, -0.102602
#*# 	-0.115304, 0.162416, 0.142798, 0.147250, 0.135444, 0.183476, 0.177973, 0.174416, 0.173021, 0.162184, 0.233406, 0.235396, 0.233957, 0.234199, 0.216304, 0.275442, 0.276109, 0.239616, 0.224881, 0.176737, 0.194446, 0.174973, 0.121076, 0.080565, 0.015691, 0.008429, -0.008739, -0.039118, -0.082978, -0.153491
#*# 	-0.174275, 0.123240, 0.069683, 0.073545, 0.096048, 0.114923, 0.137398, 0.111439, 0.106478, 0.131710, 0.167956, 0.175765, 0.176719, 0.175033, 0.159453, 0.178194, 0.200542, 0.186914, 0.161444, 0.135085, 0.141862, 0.113118, 0.093232, 0.030464, -0.018541, -0.022939, -0.044258, -0.123127, -0.106505, -0.164164
#*# 	-0.189108, 0.079636, 0.010847, 0.027058, 0.041266, 0.083609, 0.075956, 0.069487, 0.066131, 0.051886, 0.120579, 0.117903, 0.112309, 0.119542, 0.076581, 0.120187, 0.157048, 0.130050, 0.114989, 0.075813, 0.097629, 0.079503, 0.034080, -0.002119, -0.060304, -0.049800, -0.067047, -0.131148, -0.145371, -0.177905
#*# 	-0.245250, 0.058362, 0.033776, 0.029288, 0.020388, 0.037584, 0.049618, 0.016795, 0.017981, 0.030305, 0.061829, 0.066036, 0.063245, 0.068632, 0.054064, 0.086303, 0.093571, 0.076562, 0.059383, 0.034897, 0.043731, 0.020256, 0.006947, -0.050805, -0.088669, -0.081082, -0.083392, -0.127980, -0.122176, -0.194847
#*# 	-0.284099, 0.002515, -0.021610, -0.028515, -0.039828, -0.012610, -0.026284, -0.034339, -0.046334, -0.053914, 0.004597, -0.000661, 0.000880, -0.005895, -0.014788, 0.040491, 0.044944, 0.019188, -0.000352, -0.030129, -0.005276, -0.025270, -0.058708, -0.091315, -0.139790, -0.116072, -0.117913, -0.128314, -0.160149, -0.228902
#*# 	-0.379730, -0.065321, -0.080654, -0.093959, -0.097011, -0.086483, -0.077937, -0.105747, -0.113034, -0.098090, -0.066734, -0.062969, -0.066518, -0.061229, -0.068727, -0.028971, -0.026069, -0.043209, -0.055116, -0.080909, -0.069464, -0.086119, -0.100158, -0.148716, -0.177336, -0.161940, -0.160115, -0.196855, -0.186317, -0.257169
#*# 	-0.428633, -0.124222, -0.149328, -0.148161, -0.160388, -0.134930, -0.143512, -0.157264, -0.161817, -0.171636, -0.120347, -0.118761, -0.119131, -0.118868, -0.129514, -0.075807, -0.066978, -0.089182, -0.106191, -0.133878, -0.110129, -0.125092, -0.153759, -0.179083, -0.220642, -0.197150, -0.191766, -0.197173, -0.227887, -0.287134
#*# 	-0.500654, -0.175947, -0.188827, -0.197176, -0.202948, -0.190969, -0.185331, -0.217428, -0.218687, -0.205791, -0.172603, -0.171583, -0.169677, -0.166197, -0.173128, -0.137556, -0.124707, -0.138579, -0.151436, -0.179961, -0.160157, -0.175029, -0.184453, -0.227540, -0.250792, -0.230413, -0.225429, -0.258094, -0.243464, -0.311978
#*# 	-0.542942, -0.239814, -0.258541, -0.257554, -0.263754, -0.240327, -0.254463, -0.266953, -0.266427, -0.277241, -0.222429, -0.219410, -0.218990, -0.215404, -0.243598, -0.178661, -0.164382, -0.187011, -0.202751, -0.231226, -0.207413, -0.217730, -0.242042, -0.260999, -0.302080, -0.276782, -0.272978, -0.277584, -0.310200, -0.371724
#*# 	-0.637740, -0.303122, -0.309413, -0.315380, -0.316977, -0.302360, -0.298802, -0.323220, -0.324994, -0.315648, -0.274026, -0.277200, -0.273499, -0.262327, -0.267884, -0.230306, -0.219771, -0.229348, -0.246925, -0.276731, -0.257689, -0.268827, -0.277414, -0.311337, -0.335788, -0.314373, -0.314381, -0.343083, -0.330745, -0.403649
#*# 	-0.689729, -0.353110, -0.368872, -0.362949, -0.368030, -0.343348, -0.364680, -0.373903, -0.370806, -0.380771, -0.325211, -0.325313, -0.324624, -0.321384, -0.327291, -0.269856, -0.267991, -0.294464, -0.308507, -0.330532, -0.304371, -0.320157, -0.329864, -0.349962, -0.388686, -0.358452, -0.357383, -0.354204, -0.390716, -0.441459
#*# 	-0.778280, -0.413558, -0.410351, -0.414850, -0.419525, -0.403541, -0.399102, -0.422638, -0.430667, -0.420836, -0.380388, -0.382906, -0.384698, -0.373746, -0.380625, -0.333162, -0.334386, -0.344993, -0.357532, -0.384297, -0.360869, -0.367056, -0.372881, -0.406623, -0.422956, -0.400508, -0.395802, -0.428347, -0.418070, -0.496877
#*# 	-0.831786, -0.474439, -0.486416, -0.479518, -0.479329, -0.460832, -0.472561, -0.485294, -0.482810, -0.490521, -0.443385, -0.438665, -0.443041, -0.443899, -0.452768, -0.397226, -0.392175, -0.413473, -0.428277, -0.443710, -0.419658, -0.427948, -0.438316, -0.455014, -0.487321, -0.458927, -0.458779, -0.455616, -0.500571, -0.550046
#*# 	-0.927697, -0.538292, -0.530053, -0.528745, -0.536935, -0.523909, -0.519203, -0.540349, -0.545672, -0.536502, -0.499657, -0.509568, -0.510594, -0.499261, -0.510935, -0.468637, -0.468936, -0.474247, -0.482285, -0.516106, -0.488675, -0.495710, -0.495290, -0.528220, -0.543469, -0.517925, -0.514944, -0.555242, -0.547515, -0.631297
#*# 	-0.963452, -0.589713, -0.597519, -0.591972, -0.588746, -0.566300, -0.588010, -0.596458, -0.597107, -0.609085, -0.564498, -0.568842, -0.572790, -0.577847, -0.590298, -0.534402, -0.537801, -0.561650, -0.570356, -0.590167, -0.562017, -0.580479, -0.583962, -0.599502, -0.635510, -0.607791, -0.606818, -0.625991, -0.671797, -0.731398
#*# 	-1.092712, -0.676279, -0.696800, -0.688487, -0.667447, -0.651753, -0.652455, -0.671473, -0.678561, -0.675224, -0.634569, -0.650087, -0.657251, -0.648828, -0.660099, -0.621634, -0.626057, -0.633520, -0.643852, -0.672542, -0.645752, -0.657257, -0.657952, -0.688975, -0.705530, -0.687991, -0.689967, -0.777684, -0.760656, -0.822476
#*# 	-1.144742, -0.732617, -0.759394, -0.735967, -0.717374, -0.697856, -0.712837, -0.724567, -0.721412, -0.733543, -0.692742, -0.695217, -0.705164, -0.710996, -0.723769, -0.671579, -0.676289, -0.698917, -0.708313, -0.724186, -0.703743, -0.711009, -0.719644, -0.737575, -0.776083, -0.742999, -0.758320, -0.797392, -0.848195, -0.893612
#*# 	-1.113086, -0.766621, -0.750357, -0.732232, -0.737690, -0.722756, -0.718993, -0.730688, -0.737714, -0.749150, -0.694001, -0.707153, -0.724326, -0.720780, -0.723384, -0.688746, -0.698537, -0.702731, -0.704392, -0.743792, -0.719971, -0.719427, -0.717140, -0.758897, -0.777196, -0.756125, -0.763754, -0.824803, -0.822791, -0.906293
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 398.0
#*# min_y = 25.0
#*# max_y = 349.0
